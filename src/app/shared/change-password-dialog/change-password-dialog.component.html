<div class="change-password-dialog">
  <div class="dialog-header">
    <h2 mat-dialog-title>Change Password</h2>
    <button mat-icon-button (click)="onCancel()" class="close-button">
      <mat-icon>close</mat-icon>
    </button>
  </div>
  
  <mat-dialog-content>
    <div class="dialog-content">
      <p class="dialog-description">
        For security reasons, please enter your current password to set a new one.
      </p>
      
      <form [formGroup]="passwordForm" class="password-form">
        <!-- Current Password -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Current Password</mat-label>
          <input matInput 
                 [type]="hideCurrentPassword ? 'password' : 'text'" 
                 formControlName="currentPassword" 
                 placeholder="Enter your current password"
                 autocomplete="current-password">
          <button mat-icon-button matSuffix 
                  (click)="toggleCurrentPasswordVisibility()" 
                  type="button"
                  [attr.aria-label]="'Hide current password'"
                  [attr.aria-pressed]="hideCurrentPassword">
            <mat-icon>{{ hideCurrentPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-error *ngIf="currentPassword?.hasError('required')">
            Current password is required
          </mat-error>
        </mat-form-field>

        <!-- New Password -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>New Password</mat-label>
          <input matInput 
                 [type]="hideNewPassword ? 'password' : 'text'" 
                 formControlName="newPassword" 
                 placeholder="Enter your new password"
                 autocomplete="new-password">
          <button mat-icon-button matSuffix 
                  (click)="toggleNewPasswordVisibility()" 
                  type="button"
                  [attr.aria-label]="'Hide new password'"
                  [attr.aria-pressed]="hideNewPassword">
            <mat-icon>{{ hideNewPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-hint>Must be at least 6 characters long</mat-hint>
          <mat-error *ngIf="newPassword?.hasError('required')">
            New password is required
          </mat-error>
          <mat-error *ngIf="newPassword?.hasError('minlength')">
            Password must be at least 6 characters
          </mat-error>
        </mat-form-field>

        <!-- Confirm New Password -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Confirm New Password</mat-label>
          <input matInput 
                 [type]="hideConfirmPassword ? 'password' : 'text'" 
                 formControlName="confirmNewPassword" 
                 placeholder="Confirm your new password"
                 autocomplete="new-password">
          <button mat-icon-button matSuffix 
                  (click)="toggleConfirmPasswordVisibility()" 
                  type="button"
                  [attr.aria-label]="'Hide confirm password'"
                  [attr.aria-pressed]="hideConfirmPassword">
            <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-error *ngIf="confirmNewPassword?.hasError('required')">
            Please confirm your new password
          </mat-error>
          <mat-error *ngIf="confirmNewPassword?.hasError('passwordMismatch')">
            Passwords do not match
          </mat-error>
        </mat-form-field>
      </form>

      <div class="password-requirements">
        <h4>Password Requirements:</h4>
        <ul>
          <li [class.valid]="newPassword?.value?.length >= 6">
            <mat-icon>{{ newPassword?.value?.length >= 6 ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
            At least 6 characters long
          </li>
          <li [class.valid]="newPassword?.value === confirmNewPassword?.value && newPassword?.value">
            <mat-icon>{{ newPassword?.value === confirmNewPassword?.value && newPassword?.value ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
            Passwords must match
          </li>
        </ul>
      </div>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end" class="dialog-actions">
    <button mat-button (click)="onCancel()" [disabled]="isSubmitting" class="cancel-btn">
      Cancel
    </button>
    <button mat-raised-button 
            color="primary" 
            (click)="onSubmit()" 
            [disabled]="passwordForm.invalid || isSubmitting"
            class="submit-btn">
      <mat-spinner *ngIf="isSubmitting" diameter="20" class="button-spinner"></mat-spinner>
      <mat-icon *ngIf="!isSubmitting" class="button-icon">lock_reset</mat-icon>
      <span class="button-text">
        {{ isSubmitting ? 'Changing Password...' : 'Change Password' }}
      </span>
    </button>
  </mat-dialog-actions>
</div>