<div class="reset-password-page">
  <div class="reset-password-card">
    <div class="logo-title">
      <img src="/images/logo.png" alt="RentEase Logo" />
      <h2><mat-icon>lock_reset</mat-icon> Reset Password</h2>
    </div>
    
    <p class="subtitle">Create your new password</p>

    <form [formGroup]="resetForm" (ngSubmit)="onSubmit()" novalidate>
    
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>New Password</mat-label>
        <input
          matInput
          [type]="hidePassword ? 'password' : 'text'"
          formControlName="newPassword"
          placeholder="Enter new password"
          (input)="onPasswordInput()"
          (blur)="onPasswordBlur()"
          [disabled]="isLoading"
          required
        />
        <button 
          mat-icon-button 
          matSuffix 
          (click)="togglePasswordVisibility()"
          type="button"
          [disabled]="isLoading"
        >
          <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-hint>Must meet all requirements below</mat-hint>
        
      
        <mat-error *ngIf="passwordError">
          {{ passwordError }}
        </mat-error>
        <mat-error *ngIf="!passwordError && newPasswordControl?.hasError('required') && newPasswordControl?.touched">
          Password is required
        </mat-error>
        <mat-error *ngIf="!passwordError && newPasswordControl?.hasError('minLength') && newPasswordControl?.touched">
          Password must be at least 6 characters long
        </mat-error>
      </mat-form-field>

     
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Confirm New Password</mat-label>
        <input
          matInput
          [type]="hideConfirmPassword ? 'password' : 'text'"
          formControlName="confirmNewPassword"
          placeholder="Confirm new password"
          (input)="onConfirmPasswordInput()"
          (blur)="onConfirmPasswordBlur()"
          [disabled]="isLoading"
          required
        />
        <button 
          mat-icon-button 
          matSuffix 
          (click)="toggleConfirmPasswordVisibility()"
          type="button"
          [disabled]="isLoading"
        >
          <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        
       
        <mat-error *ngIf="confirmPasswordError">
          {{ confirmPasswordError }}
        </mat-error>
        <mat-error *ngIf="!confirmPasswordError && confirmNewPasswordControl?.hasError('required') && confirmNewPasswordControl?.touched">
          Please confirm your password
        </mat-error>
        <mat-error *ngIf="!confirmPasswordError && resetForm.hasError('mismatch') && confirmNewPasswordControl?.touched">
          Passwords do not match
        </mat-error>
      </mat-form-field>

    
      <div class="password-requirements">
        <h4>Password Requirements:</h4>
        <div class="requirements-grid">
          <div class="requirement-item" [class.valid]="hasMinLength" [class.invalid]="newPasswordControl?.touched && !hasMinLength">
            <mat-icon class="requirement-icon">
              {{ hasMinLength ? 'check_circle' : 'radio_button_unchecked' }}
            </mat-icon>
            <span>At least 6 characters</span>
            <span class="requirement-error" *ngIf="newPasswordControl?.touched && !hasMinLength"> - Too short</span>
          </div>
          <div class="requirement-item" [class.valid]="hasLowerCase" [class.invalid]="newPasswordControl?.touched && !hasLowerCase">
            <mat-icon class="requirement-icon">
              {{ hasLowerCase ? 'check_circle' : 'radio_button_unchecked' }}
            </mat-icon>
            <span>One lowercase letter (a-z)</span>
            <span class="requirement-error" *ngIf="newPasswordControl?.touched && !hasLowerCase"> - Missing lowercase</span>
          </div>
          <div class="requirement-item" [class.valid]="hasUpperCase" [class.invalid]="newPasswordControl?.touched && !hasUpperCase">
            <mat-icon class="requirement-icon">
              {{ hasUpperCase ? 'check_circle' : 'radio_button_unchecked' }}
            </mat-icon>
            <span>One uppercase letter (A-Z)</span>
            <span class="requirement-error" *ngIf="newPasswordControl?.touched && !hasUpperCase"> - Missing uppercase</span>
          </div>
          <div class="requirement-item" [class.valid]="hasNumber" [class.invalid]="newPasswordControl?.touched && !hasNumber">
            <mat-icon class="requirement-icon">
              {{ hasNumber ? 'check_circle' : 'radio_button_unchecked' }}
            </mat-icon>
            <span>One number (0-9)</span>
            <span class="requirement-error" *ngIf="newPasswordControl?.touched && !hasNumber"> - Missing number</span>
          </div>
          <div class="requirement-item" [class.valid]="hasSpecialChar" [class.invalid]="newPasswordControl?.touched && !hasSpecialChar">
            <mat-icon class="requirement-icon">
              {{ hasSpecialChar ? 'check_circle' : 'radio_button_unchecked' }}
            </mat-icon>
            <span>One special character (!@#$% etc.)</span>
            <span class="requirement-error" *ngIf="newPasswordControl?.touched && !hasSpecialChar"> - Missing special character</span>
          </div>
        </div>
        
        <div class="password-strength" [class]="passwordStrength">
          <div class="strength-bar">
            <div class="strength-fill" [style.width.%]="getStrengthPercentage()"></div>
          </div>
          <span class="strength-text">Strength: {{ passwordStrength | titlecase }}</span>
        </div>
      </div>

      <button
        mat-raised-button
        color="primary"
        class="full-width submit-btn"
        type="submit"
        [disabled]="isLoading || !isFormValid"
      >
        <mat-spinner diameter="20" *ngIf="isLoading" class="button-spinner"></mat-spinner>
        <span *ngIf="!isLoading">Reset Password</span>
        <span *ngIf="isLoading">Resetting Password...</span>
      </button>
    </form>
    
    <div class="action-links">
      <a (click)="navigateToLogin()" class="back-link" [class.disabled]="isLoading">
        <mat-icon>arrow_back</mat-icon>
        Back to Login
      </a>
      <a (click)="navigateToForgotPassword()" class="back-link" [class.disabled]="isLoading">
        <mat-icon>lock_reset</mat-icon>
        Request New OTP
      </a>
    </div>
  </div>
</div>