<div class="login-container">
  <div class="header">
    <h1>Welcome Back</h1>
    <p class="subtitle">Sign in to your RentEase account</p>
  </div>

  <!-- Step 1: Phone Number Entry -->
  <div *ngIf="currentStep === 'phone'" class="login-step">
    <form (ngSubmit)="sendOTP()" #phoneForm="ngForm">
      <div class="form-group">
        <label>Phone Number</label>
        <input 
          type="tel" 
          class="form-control" 
          [(ngModel)]="phoneNumber" 
          name="phone" 
          placeholder="+254 700 000 000"
          required />
        <small class="form-text">Enter the phone number you used to register</small>
      </div>

      <button 
        type="submit" 
        class="btn btn-primary btn-large" 
        [disabled]="!phoneForm.valid || isLoading">
        <span *ngIf="isLoading" class="spinner"></span>
        <span *ngIf="!isLoading">Send OTP</span>
        <span *ngIf="!isLoading" class="btn-icon">📱</span>
      </button>
    </form>
  </div>

  <!-- Step 2: OTP Verification -->
  <div *ngIf="currentStep === 'otp'" class="login-step">
    <div class="otp-header">
      <h3>Verify Your Phone</h3>
      <p>We sent a 6-digit code to <strong>{{maskedPhone}}</strong></p>
    </div>

    <form (ngSubmit)="verifyOTP()" #otpForm="ngForm">
      <div class="form-group">
        <label>Enter 6-Digit Code</label>
        <div class="otp-input-container">
          <input 
            type="text" 
            class="otp-input" 
            [(ngModel)]="otpCode" 
            name="otp"
            maxlength="6"
            placeholder="000000"
            required />
        </div>
        <small class="form-text">Code expires in {{countdown}} seconds</small>
      </div>

      <button 
        type="submit" 
        class="btn btn-primary btn-large" 
        [disabled]="!otpForm.valid || isLoading">
        <span *ngIf="isLoading" class="spinner"></span>
        <span *ngIf="!isLoading">Verify & Login</span>
        <span *ngIf="!isLoading" class="btn-icon">✓</span>
      </button>

      <!-- Resend OTP Option -->
      <div class="resend-section">
        <p *ngIf="countdown > 0">Didn't receive code? Wait {{countdown}}s</p>
        <button 
          *ngIf="countdown === 0" 
          type="button" 
          class="resend-btn"
          (click)="resendOTP()"
          [disabled]="isLoading">
          Resend Code
        </button>
      </div>

      <!-- Change Phone Number Option -->
      <div class="change-phone">
        <button type="button" class="change-phone-btn" (click)="goBackToPhone()">
          ← Use different phone number
        </button>
      </div>
    </form>
  </div>

  <!-- Step 3: Email Verification (Optional) -->
  <div *ngIf="currentStep === 'email-verify'" class="login-step">
    <div class="email-verify-header">
      <h3>Additional Security</h3>
      <p>For extra security, verify your email address</p>
    </div>

    <form (ngSubmit)="sendEmailVerification()" #emailForm="ngForm">
      <div class="form-group">
        <label>Email Address</label>
        <input 
          type="email" 
          class="form-control" 
          [(ngModel)]="emailAddress" 
          name="email"
          [value]="userEmail"
          readonly />
        <small class="form-text">We'll send a verification link to this email</small>
      </div>

      <div class="security-buttons">
        <button 
          type="submit" 
          class="btn btn-primary btn-large" 
          [disabled]="isLoading">
          <span *ngIf="isLoading" class="spinner"></span>
          <span *ngIf="!isLoading">Send Email Verification</span>
          <span *ngIf="!isLoading" class="btn-icon">📧</span>
        </button>
        
        <button 
          type="button" 
          class="btn btn-secondary btn-large"
          (click)="skipEmailVerification()">
          Skip for Now
          <span class="btn-icon">→</span>
        </button>
      </div>
    </form>
  </div>

  <!-- Error Messages -->
  <div *ngIf="errorMessage" class="error-message">
    <span class="error-icon">⚠️</span>
    {{errorMessage}}
  </div>

  <!-- Success Messages -->
  <div *ngIf="successMessage" class="success-message">
    <span class="success-icon">✅</span>
    {{successMessage}}
  </div>

  <!-- Footer -->
  <div class="form-footer">
    <div class="registration-prompt">
      <p>Don't have an account? 
        <button type="button" class="register-link" (click)="navigateToRegistration()">
          Create Account
        </button>
      </p>
    </div>
    
    <!-- Security Note -->
    <div class="security-note">
      <p>🔒 Secure login with OTP verification</p>
    </div>
  </div>
</div>