<div class="dashboard-grid">
  
  <div class="card card-feature collapsible-card" 
       [class.collapsed]="isSectionCollapsed('deposit')"
       [class.animating]="isAnimating('deposit')">
    <div class="card-header clickable-header" (click)="toggleSection('deposit')">
      <div class="card-title">
        <mat-icon class="card-icon">account_balance_wallet</mat-icon>
        <h3>Deposit Status</h3>
      </div>
      <div class="header-actions">
        <button class="card-action" 
                (click)="viewDepositDetails(); $event.stopPropagation()"
                title="View detailed deposit information">
          View Details
          <mat-icon>chevron_right</mat-icon>
        </button>
        <button class="collapse-toggle" 
                [attr.aria-label]="getAriaLabel('deposit')"
                title="Toggle deposit section">
          <mat-icon class="collapse-icon">expand_more</mat-icon>
        </button>
      </div>
    </div>
    
    <div class="card-content collapsible-content" [class.collapsed]="isSectionCollapsed('deposit')">
      <div class="deposit-summary">
        <div class="amount-display">
          <span class="currency">KSH</span>
          <span class="amount">{{formatNumber(depositAmount)}}</span>
        </div>
        
        <div class="status-info">
          <div class="status-badge status-success">
            <mat-icon>verified</mat-icon>
            {{getDepositStatusText()}}
          </div>
          <div class="protection-info">
            <mat-icon>shield</mat-icon>
            <span>Government Deposit Protection</span>
          </div>
        </div>
      </div>
      
      <div class="timeline-progress">
        <div class="progress-header">
          <span class="progress-label">Completion Progress</span>
          <span class="progress-count">
            {{getCompletedTimelineCount()}}/{{getTotalTimelineCount()}} completed
          </span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" 
               [style.width.%]="getTimelineCompletionPercentage()">
          </div>
        </div>
      </div>
      
      <div class="progress-timeline" *ngIf="depositTimeline && depositTimeline.length > 0">
        <div class="timeline-item" 
             *ngFor="let event of depositTimeline; let i = index"
             [class.completed]="event.completed">
          <div class="timeline-indicator" [class.timeline-completed]="event.completed">
            <mat-icon class="timeline-icon" *ngIf="event.completed">check_circle</mat-icon>
            <mat-icon class="timeline-icon" *ngIf="!event.completed">radio_button_unchecked</mat-icon>
            <div class="timeline-line" *ngIf="i < depositTimeline.length - 1"></div>
          </div>
          <div class="timeline-content">
            <div class="timeline-title">{{event.title}}</div>
            <div class="timeline-date">{{event.date}}</div>
            <div class="timeline-description" *ngIf="event.description">
              {{event.description}}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card collapsible-card" 
       [class.collapsed]="isSectionCollapsed('rental')"
       [class.animating]="isAnimating('rental')">
    <div class="card-header clickable-header" (click)="toggleSection('rental')">
      <div class="card-title">
        <mat-icon class="card-icon">home</mat-icon>
        <h3>Current Rental</h3>
      </div>
      <div class="header-actions">
        <button class="card-action" 
                (click)="viewPaymentHistory(); $event.stopPropagation()"
                title="View payment history">
          Payment History
          <mat-icon>chevron_right</mat-icon>
        </button>
        <button class="collapse-toggle" 
                [attr.aria-label]="getAriaLabel('rental')"
                title="Toggle rental section">
          <mat-icon class="collapse-icon">expand_more</mat-icon>
        </button>
      </div>
    </div>
    
    <div class="card-content collapsible-content" [class.collapsed]="isSectionCollapsed('rental')">
      <div class="rental-overview">
        <div class="property-info">
          <div class="property-address">
            <mat-icon>location_on</mat-icon>
            <span>{{propertyAddress}}</span>
          </div>
          <div class="landlord-info">
            <mat-icon>person</mat-icon>
            <span>{{landlordName}}</span>
          </div>
        </div>
        
        <div class="payment-info">
          <div class="rent-amount">
            <div class="amount-label">Monthly Rent</div>
            <div class="amount-value">{{formatCurrency(rentAmount)}}</div>
          </div>
          
          <div class="payment-status">
            <div class="status-badge" [ngClass]="paymentStatus.className">
              <mat-icon *ngIf="paymentStatus.status === 'Paid'">check_circle</mat-icon>
              <mat-icon *ngIf="paymentStatus.status !== 'Paid'">schedule</mat-icon>
              {{paymentStatus.status}}
            </div>
            <div class="next-due" *ngIf="paymentStatus.status === 'Paid'">
              Next due: {{nextRentDueDate}}
            </div>
            <div class="days-left" *ngIf="paymentStatus.status !== 'Paid'">
              {{paymentStatus.daysLeft}} days remaining
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card collapsible-card" 
       [class.collapsed]="isSectionCollapsed('quickActions')"
       [class.animating]="isAnimating('quickActions')">
    <div class="card-header clickable-header" (click)="toggleSection('quickActions')">
      <div class="card-title">
        <mat-icon class="card-icon">flash_on</mat-icon>
        <h3>Quick Actions</h3>
      </div>
      <button class="collapse-toggle" 
              [attr.aria-label]="getAriaLabel('quickActions')"
              title="Toggle quick actions section">
        <mat-icon class="collapse-icon">expand_more</mat-icon>
      </button>
    </div>
    
    <div class="card-content collapsible-content" [class.collapsed]="isSectionCollapsed('quickActions')">
      <div class="action-grid">
        <button class="action-btn" 
                *ngFor="let action of quickActions"
                (click)="executeQuickAction(action.id)"
                [title]="action.description">
          <div class="action-icon" [style.background-color]="action.color">
            <mat-icon>{{action.icon}}</mat-icon>
          </div>
          <span class="action-label">{{action.title}}</span>
          <span class="action-description">{{action.description}}</span>
        </button>
      </div>
    </div>
  </div>

  <div class="card card-full-width collapsible-card" 
       [class.collapsed]="isSectionCollapsed('activity')"
       [class.animating]="isAnimating('activity')">
    <div class="card-header clickable-header" (click)="toggleSection('activity')">
      <div class="card-title">
        <mat-icon class="card-icon">history</mat-icon>
        <h3>Recent Activity</h3>
        <span class="activity-count" *ngIf="hasRecentActivities()">
          ({{getRecentActivitiesCount()}})
        </span>
      </div>
      <div class="header-actions">
        <button class="refresh-btn" 
                (click)="refreshData(); $event.stopPropagation()"
                title="Refresh activity data">
          <mat-icon>refresh</mat-icon>
        </button>
        <button class="collapse-toggle" 
                [attr.aria-label]="getAriaLabel('activity')"
                title="Toggle activity section">
          <mat-icon class="collapse-icon">expand_more</mat-icon>
        </button>
      </div>
    </div>
    
    <div class="card-content collapsible-content" [class.collapsed]="isSectionCollapsed('activity')">
      <div class="activity-list" *ngIf="hasRecentActivities(); else noActivities">
        <div class="activity-item" 
             *ngFor="let activity of recentActivities; trackBy: trackByActivityId">
          <div class="activity-icon" [ngClass]="getActivityIconClass(activity.type)">
            <mat-icon>{{activity.icon}}</mat-icon>
          </div>
          <div class="activity-content">
            <div class="activity-title">{{activity.title}}</div>
            <div class="activity-description">{{activity.description}}</div>
            <div class="activity-time">
              <mat-icon>schedule</mat-icon>
              {{activity.time}}
            </div>
          </div>
        </div>
      </div>
      
      <ng-template #noActivities>
        <div class="no-activities">
          <mat-icon>inbox</mat-icon>
          <p>No recent activity to display</p>
        </div>
      </ng-template>
    </div>
  </div>

</div>