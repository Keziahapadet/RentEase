<div class="modern-dashboard">
  <!-- Sidebar -->
  <aside class="sidebar" [class.sidebar-open]="isMobileMenuOpen">
    <div class="sidebar-header">
      <div class="logo">
        <mat-icon class="logo-icon">home</mat-icon>
        <span class="logo-text">RentEase</span>
      </div>
    </div>
    
    <nav class="sidebar-nav">
      <div class="nav-primary">
        <a 
          href="javascript:void(0)" 
          class="nav-item" 
          [class.nav-item-active]="activeSection === 'dashboard'"
          (click)="setActiveSection('dashboard')">
          <mat-icon class="nav-icon">dashboard</mat-icon>
          <span class="nav-text">Dashboard</span>
        </a>
        
        <a 
          *ngFor="let item of navigationItems" 
          href="javascript:void(0)" 
          class="nav-item"
          [class.nav-item-active]="activeSection === item.id"
          (click)="setActiveSection(item.id)">
          <mat-icon class="nav-icon">{{item.icon}}</mat-icon>
          <span class="nav-text">{{item.text}}</span>
        </a>
      </div>
      
      <div class="nav-secondary">
        <a href="javascript:void(0)" class="nav-item nav-item-logout" (click)="logout()">
          <mat-icon class="nav-icon">logout</mat-icon>
          <span class="nav-text">Logout</span>
        </a>
      </div>
    </nav>
  </aside>

  <!-- Mobile Overlay -->
  <div 
    class="mobile-overlay" 
    [class.mobile-overlay-active]="isMobileMenuOpen"
    (click)="closeMobileMenu()">
  </div>

  <!-- Main Content -->
  <main class="main-container">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="header-left">
          <button 
            class="mobile-menu-btn"
            (click)="toggleMobileMenu()"
            aria-label="Toggle menu">
            <mat-icon>menu</mat-icon>
          </button>
          
          <div class="welcome-section">
            <div class="profile-section">
              <img 
                [src]="userProfilePictureUrl" 
                alt="{{userName}}'s profile picture" 
                class="profile-picture"
              />
              <div class="welcome-content">
                <h1 class="welcome-title">Welcome back, {{userName}}!</h1>
                <p class="welcome-subtitle">{{propertyAddress}}</p>
              </div>
            </div>
          </div>
        </div>
        
        <div class="header-right">
          <!-- Collapse Controls -->
          <div class="collapse-controls" *ngIf="activeSection === 'dashboard'">
            <button class="control-btn" (click)="expandAllSections()" title="Expand All">
              <mat-icon>unfold_more</mat-icon>
            </button>
            <button class="control-btn" (click)="collapseAllSections()" title="Collapse All">
              <mat-icon>unfold_less</mat-icon>
            </button>
            <span class="collapse-counter" *ngIf="getCollapsedCount() > 0">
              {{getCollapsedCount()}} collapsed
            </span>
          </div>

          <button class="notification-btn" (click)="toggleNotifications()" aria-label="Notifications">
            <mat-icon class="notification-icon">notifications</mat-icon>
            <span class="notification-badge" *ngIf="unreadNotifications > 0">{{unreadNotifications}}</span>
          </button>
          
          <div class="user-menu">
            <div class="user-avatar">{{userInitials}}</div>
            <div class="user-info">
              <div class="user-name">{{userName}}</div>
              <div class="user-role">Tenant</div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Dashboard Content -->
    <div class="content-area">
      
      <!-- Dashboard Overview -->
      <div class="page-content" *ngIf="activeSection === 'dashboard'">
        <div class="dashboard-grid">
          
          <!-- Collapsible Deposit Status Card -->
          <div class="card card-feature collapsible-card" 
               [class.collapsed]="isSectionCollapsed('deposit')"
               [class.animating]="isAnimating('deposit')">
            <div class="card-header clickable-header" (click)="toggleSection('deposit')">
              <div class="card-title">
                <mat-icon class="card-icon">account_balance_wallet</mat-icon>
                <h3>Deposit Status</h3>
              </div>
              <div class="header-actions">
                <button class="card-action" (click)="setActiveSection('deposit')" (click)="$event.stopPropagation()">
                  View Details
                  <mat-icon>chevron_right</mat-icon>
                </button>
                <button class="collapse-toggle">
                  <mat-icon class="collapse-icon">expand_more</mat-icon>
                </button>
              </div>
            </div>
            
            <div class="card-content collapsible-content" [class.collapsed]="isSectionCollapsed('deposit')">
              <div class="amount-display">
                <span class="currency">KSH</span>
                <span class="amount">{{formatNumber(depositAmount)}}</span>
              </div>
              <div class="status-badge status-success">
                <mat-icon>verified</mat-icon>
                {{getDepositStatusText()}}
              </div>
              
              <div class="progress-timeline">
                <div class="timeline-item" *ngFor="let event of depositTimeline; let i = index">
                  <div class="timeline-indicator" [class.timeline-completed]="event.completed">
                    <mat-icon class="timeline-icon" *ngIf="event.completed">check_circle</mat-icon>
                    <mat-icon class="timeline-icon" *ngIf="!event.completed">radio_button_unchecked</mat-icon>
                    <div class="timeline-line" *ngIf="i < depositTimeline.length - 1"></div>
                  </div>
                  <div class="timeline-content">
                    <div class="timeline-title">{{event.title}}</div>
                    <div class="timeline-date">{{event.date}}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Collapsible Current Rental Card -->
          <div class="card collapsible-card" 
               [class.collapsed]="isSectionCollapsed('rental')"
               [class.animating]="isAnimating('rental')">
            <div class="card-header clickable-header" (click)="toggleSection('rental')">
              <div class="card-title">
                <mat-icon class="card-icon">home</mat-icon>
                <h3>Current Rental</h3>
              </div>
              <div class="header-actions">
                <button class="card-action" (click)="setActiveSection('payments')" (click)="$event.stopPropagation()">
                  Payment History
                  <mat-icon>chevron_right</mat-icon>
                </button>
                <button class="collapse-toggle">
                  <mat-icon class="collapse-icon">expand_more</mat-icon>
                </button>
              </div>
            </div>
            
            <div class="card-content collapsible-content" [class.collapsed]="isSectionCollapsed('rental')">
              <div class="property-details">
                <div class="detail-row">
                  <span class="detail-label">
                    <mat-icon>location_on</mat-icon>
                    Property
                  </span>
                  <span class="detail-value">{{propertyAddress}}</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">
                    <mat-icon>person</mat-icon>
                    Landlord
                  </span>
                  <span class="detail-value">{{landlordName}}</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">
                    <mat-icon>payments</mat-icon>
                    Monthly Rent
                  </span>
                  <span class="detail-value">KSH {{formatNumber(rentAmount)}}</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">
                    <mat-icon>info</mat-icon>
                    Status
                  </span>
                  <div class="status-badge status-success">
                    <mat-icon>check_circle</mat-icon>
                    Paid
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Collapsible Quick Actions Card -->
          <div class="card collapsible-card" 
               [class.collapsed]="isSectionCollapsed('quickActions')"
               [class.animating]="isAnimating('quickActions')">
            <div class="card-header clickable-header" (click)="toggleSection('quickActions')">
              <div class="card-title">
                <mat-icon class="card-icon">flash_on</mat-icon>
                <h3>Quick Actions</h3>
              </div>
              <button class="collapse-toggle">
                <mat-icon class="collapse-icon">expand_more</mat-icon>
              </button>
            </div>
            
            <div class="card-content collapsible-content" [class.collapsed]="isSectionCollapsed('quickActions')">
              <div class="action-grid">
                <button class="action-btn" (click)="makePayment()">
                  <div class="action-icon">
                    <mat-icon>payment</mat-icon>
                  </div>
                  <span>Pay Rent</span>
                </button>
                <button class="action-btn" (click)="setActiveSection('maintenance')">
                  <div class="action-icon">
                    <mat-icon>build</mat-icon>
                  </div>
                  <span>Report Issue</span>
                </button>
                <button class="action-btn" (click)="setActiveSection('messages')">
                  <div class="action-icon">
                    <mat-icon>message</mat-icon>
                  </div>
                  <span>Message</span>
                </button>
                <button class="action-btn" (click)="setActiveSection('documents')">
                  <div class="action-icon">
                    <mat-icon>folder</mat-icon>
                  </div>
                  <span>Documents</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Collapsible Recent Activity Card -->
          <div class="card card-full-width collapsible-card" 
               [class.collapsed]="isSectionCollapsed('activity')"
               [class.animating]="isAnimating('activity')">
            <div class="card-header clickable-header" (click)="toggleSection('activity')">
              <div class="card-title">
                <mat-icon class="card-icon">history</mat-icon>
                <h3>Recent Activity</h3>
              </div>
              <button class="collapse-toggle">
                <mat-icon class="collapse-icon">expand_more</mat-icon>
              </button>
            </div>
            
            <div class="card-content collapsible-content" [class.collapsed]="isSectionCollapsed('activity')">
              <div class="activity-list">
                <div class="activity-item">
                  <div class="activity-icon activity-success">
                    <mat-icon>check</mat-icon>
                  </div>
                  <div class="activity-content">
                    <div class="activity-title">February rent payment received</div>
                    <div class="activity-time">2 days ago</div>
                  </div>
                </div>
                <div class="activity-item">
                  <div class="activity-icon activity-info">
                    <mat-icon>build</mat-icon>
                  </div>
                  <div class="activity-content">
                    <div class="activity-title">Maintenance request submitted</div>
                    <div class="activity-time">5 days ago</div>
                  </div>
                </div>
                <div class="activity-item">
                  <div class="activity-icon activity-info">
                    <mat-icon>mail</mat-icon>
                  </div>
                  <div class="activity-content">
                    <div class="activity-title">Message from landlord</div>
                    <div class="activity-time">1 week ago</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
      
      <!-- Deposit Details Section -->
      <div class="page-content" *ngIf="activeSection === 'deposit'">
        <div class="page-header">
          <button class="back-btn" (click)="setActiveSection('dashboard')">
            <mat-icon>arrow_back</mat-icon>
            Back to Dashboard
          </button>
          <div class="page-title">
            <h2>Deposit Details</h2>
            <p>Your security deposit information and protection details</p>
          </div>
        </div>
        
        <div class="content-grid">
          <div class="card collapsible-card" 
               [class.collapsed]="isSectionCollapsed('deposit')"
               [class.animating]="isAnimating('deposit')">
            <div class="card-header clickable-header" (click)="toggleSection('deposit')">
              <div class="card-title">
                <mat-icon class="card-icon">summarize</mat-icon>
                <h3>Deposit Summary</h3>
              </div>
              <button class="collapse-toggle">
                <mat-icon class="collapse-icon">expand_more</mat-icon>
              </button>
            </div>
            <div class="card-content collapsible-content" [class.collapsed]="isSectionCollapsed('deposit')">
              <div class="summary-stats">
                <div class="stat-item">
                  <mat-icon class="stat-icon">account_balance_wallet</mat-icon>
                  <span class="stat-label">Deposit Amount</span>
                  <span class="stat-value">KSH {{formatNumber(depositAmount)}}</span>
                </div>
                <div class="stat-item">
                  <mat-icon class="stat-icon">verified_user</mat-icon>
                  <span class="stat-label">Status</span>
                  <div class="status-badge status-success">
                    <mat-icon>shield</mat-icon>
                    Protected
                  </div>
                </div>
                <div class="stat-item">
                  <mat-icon class="stat-icon">security</mat-icon>
                  <span class="stat-label">Protection Scheme</span>
                  <span class="stat-value">Government Deposit Protection</span>
                </div>
                <div class="stat-item">
                  <mat-icon class="stat-icon">event</mat-icon>
                  <span class="stat-label">Date Paid</span>
                  <span class="stat-value">January 15, 2024</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <mat-icon class="card-icon">timeline</mat-icon>
                <h3>Timeline</h3>
              </div>
            </div>
            <div class="card-content">
              <div class="progress-timeline">
                <div class="timeline-item" *ngFor="let event of depositTimeline; let i = index">
                  <div class="timeline-indicator" [class.timeline-completed]="event.completed">
                    <mat-icon class="timeline-icon" *ngIf="event.completed">check_circle</mat-icon>
                    <mat-icon class="timeline-icon" *ngIf="!event.completed">radio_button_unchecked</mat-icon>
                    <div class="timeline-line" *ngIf="i < depositTimeline.length - 1"></div>
                  </div>
                  <div class="timeline-content">
                    <div class="timeline-title">{{event.title}}</div>
                    <div class="timeline-date">{{event.date}}</div>
                    <div class="timeline-description" *ngIf="event.completed">
                      <mat-icon>done</mat-icon>
                      Status: Completed
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Payments Section -->
      <div class="page-content" *ngIf="activeSection === 'payments'">
        <div class="page-header">
          <button class="back-btn" (click)="setActiveSection('dashboard')">
            <mat-icon>arrow_back</mat-icon>
            Back to Dashboard
          </button>
          <div class="page-title">
            <h2>Payment History</h2>
            <p>View and manage your rental payments</p>
          </div>
        </div>
        
        <div class="card collapsible-card" 
             [class.collapsed]="isSectionCollapsed('payments')"
             [class.animating]="isAnimating('payments')">
          <div class="card-header clickable-header" (click)="toggleSection('payments')">
            <div class="card-title">
              <mat-icon class="card-icon">payment</mat-icon>
              <h3>Recent Payments</h3>
            </div>
            <div class="header-actions">
              <button class="btn btn-primary" (click)="makePayment()" (click)="$event.stopPropagation()">
                <mat-icon>add</mat-icon>
                Make Payment
              </button>
              <button class="collapse-toggle">
                <mat-icon class="collapse-icon">expand_more</mat-icon>
              </button>
            </div>
          </div>
          <div class="card-content collapsible-content" [class.collapsed]="isSectionCollapsed('payments')">
            <div class="table-container">
              <table class="modern-table">
                <thead>
                  <tr>
                    <th>
                      <mat-icon>event</mat-icon>
                      Date
                    </th>
                    <th>
                      <mat-icon>category</mat-icon>
                      Type
                    </th>
                    <th>
                      <mat-icon>attach_money</mat-icon>
                      Amount
                    </th>
                    <th>
                      <mat-icon>credit_card</mat-icon>
                      Method
                    </th>
                    <th>
                      <mat-icon>info</mat-icon>
                      Status
                    </th>
                    <th>
                      <mat-icon>confirmation_number</mat-icon>
                      Reference
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let payment of paymentHistory">
                    <td>{{payment.date}}</td>
                    <td>{{payment.type}}</td>
                    <td>KSH {{formatNumber(payment.amount)}}</td>
                    <td>{{payment.method}}</td>
                    <td>
                      <div class="status-badge" [ngClass]="getStatusClass(payment.status)">
                        <mat-icon *ngIf="payment.status === 'paid'">check_circle</mat-icon>
                        <mat-icon *ngIf="payment.status === 'pending'">schedule</mat-icon>
                        <mat-icon *ngIf="payment.status === 'overdue'">error</mat-icon>
                        {{payment.status | titlecase}}
                      </div>
                    </td>
                    <td>{{payment.reference}}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Maintenance Section -->
      <div class="page-content" *ngIf="activeSection === 'maintenance'">
        <div class="page-header">
          <button class="back-btn" (click)="setActiveSection('dashboard')">
            <mat-icon>arrow_back</mat-icon>
            Back to Dashboard
          </button>
          <div class="page-title">
            <h2>Maintenance Requests</h2>
            <p>Submit and track maintenance issues</p>
          </div>
        </div>
        
        <div class="content-grid">
          <div class="card collapsible-card" 
               [class.collapsed]="isSectionCollapsed('maintenance')"
               [class.animating]="isAnimating('maintenance')">
            <div class="card-header clickable-header" (click)="toggleSection('maintenance')">
              <div class="card-title">
                <mat-icon class="card-icon">add_task</mat-icon>
                <h3>Submit New Request</h3>
              </div>
              <button class="collapse-toggle">
                <mat-icon class="collapse-icon">expand_more</mat-icon>
              </button>
            </div>
            <div class="card-content collapsible-content" [class.collapsed]="isSectionCollapsed('maintenance')">
              <form (ngSubmit)="submitMaintenanceRequest()" #maintenanceForm="ngForm" class="modern-form">
                <div class="form-group">
                  <label for="title" class="form-label">
                    <mat-icon>title</mat-icon>
                    Issue Title
                  </label>
                  <input 
                    type="text" 
                    id="title" 
                    [(ngModel)]="newMaintenanceRequest.title" 
                    name="title"
                    class="form-input" 
                    placeholder="Brief description of the issue"
                    required>
                </div>
                
                <div class="form-group">
                  <label for="category" class="form-label">
                    <mat-icon>category</mat-icon>
                    Category
                  </label>
                  <select 
                    id="category" 
                    [(ngModel)]="newMaintenanceRequest.category" 
                    name="category"
                    class="form-select">
                    <option value="">Select category</option>
                    <option value="Plumbing">Plumbing</option>
                    <option value="Electrical">Electrical</option>
                    <option value="HVAC">HVAC</option>
                    <option value="General Repairs">General Repairs</option>
                    <option value="Appliances">Appliances</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label for="priority" class="form-label">
                    <mat-icon>priority_high</mat-icon>
                    Priority
                  </label>
                  <select 
                    id="priority" 
                    [(ngModel)]="newMaintenanceRequest.priority" 
                    name="priority"
                    class="form-select">
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                    <option value="urgent">Urgent</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label for="description" class="form-label">
                    <mat-icon>description</mat-icon>
                    Description
                  </label>
                  <textarea 
                    id="description" 
                    [(ngModel)]="newMaintenanceRequest.description" 
                    name="description"
                    class="form-textarea" 
                    rows="4"
                    placeholder="Detailed description of the issue"
                    required></textarea>
                </div>
                
                <button type="submit" class="btn btn-primary" [disabled]="!maintenanceForm.form.valid">
                  <mat-icon>send</mat-icon>
                  Submit Request
                </button>
              </form>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <mat-icon class="card-icon">list</mat-icon>
                <h3>Your Requests</h3>
              </div>
            </div>
            <div class="card-content">
              <div class="request-list">
                <div class="request-item" *ngFor="let request of maintenanceRequests">
                  <div class="request-header">
                    <h4 class="request-title">{{request.title}}</h4>
                    <div class="status-badge" [ngClass]="getStatusClass(request.status)">
                      <mat-icon *ngIf="request.status === 'completed'">check_circle</mat-icon>
                      <mat-icon *ngIf="request.status === 'in-progress'">schedule</mat-icon>
                      <mat-icon *ngIf="request.status === 'submitted'">hourglass_empty</mat-icon>
                      <mat-icon *ngIf="request.status === 'cancelled'">cancel</mat-icon>
                      {{request.status | titlecase}}
                    </div>
                  </div>
                  <div class="request-meta">
                    <span class="meta-item">
                      <mat-icon>category</mat-icon>
                      Category: {{request.category}}
                    </span>
                    <span class="meta-item">
                      Priority: 
                      <span class="priority-badge" [ngClass]="getPriorityClass(request.priority)">
                        <mat-icon *ngIf="request.priority === 'urgent'">warning</mat-icon>
                        <mat-icon *ngIf="request.priority === 'high'">priority_high</mat-icon>
                        <mat-icon *ngIf="request.priority === 'medium'">remove</mat-icon>
                        <mat-icon *ngIf="request.priority === 'low'">arrow_drop_down</mat-icon>
                        {{request.priority | titlecase}}
                      </span>
                    </span>
                    <span class="meta-item">
                      <mat-icon>event</mat-icon>
                      Submitted: {{request.dateSubmitted}}
                    </span>
                  </div>
                  <p class="request-description">{{request.description}}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Documents Section -->
      <div class="page-content" *ngIf="activeSection === 'documents'">
        <div class="page-header">
          <button class="back-btn" (click)="setActiveSection('dashboard')">
            <mat-icon>arrow_back</mat-icon>
            Back to Dashboard
          </button>
          <div class="page-title">
            <h2>Documents</h2>
            <p>Access all your rental documents</p>
          </div>
        </div>
        
        <div class="card collapsible-card" 
             [class.collapsed]="isSectionCollapsed('documents')"
             [class.animating]="isAnimating('documents')">
          <div class="card-header clickable-header" (click)="toggleSection('documents')">
            <div class="card-title">
              <mat-icon class="card-icon">folder_open</mat-icon>
              <h3>My Documents</h3>
            </div>
            <div class="header-actions">
              <select class="form-control" (click)="$event.stopPropagation()">
                <option value="">All Categories</option>
                <option value="Legal">Legal</option>
                <option value="Payments">Payments</option>
                <option value="Inspection">Inspection</option>
                <option value="Insurance">Insurance</option>
              </select>
              <button class="collapse-toggle">
                <mat-icon class="collapse-icon">expand_more</mat-icon>
              </button>
            </div>
          </div>
          <div class="card-content collapsible-content" [class.collapsed]="isSectionCollapsed('documents')">
            <div class="document-grid">
              <div class="document-card" *ngFor="let doc of documents">
                <div class="document-header">
                  <div class="document-icon-large">
                    <mat-icon>{{doc.icon}}</mat-icon>
                  </div>
                  <div class="document-actions">
                    <button class="btn-icon" (click)="downloadDocument(doc)" title="Download">
                      <mat-icon>download</mat-icon>
                    </button>
                  </div>
                </div>
                <div class="document-info">
                  <h4>{{doc.name}}</h4>
                  <div class="document-meta">
                    <span class="document-date">
                      <mat-icon>event</mat-icon>
                      {{doc.date}}
                    </span>
                    <span class="document-size">{{doc.size}}</span>
                  </div>
                  <span class="document-category">
                    <mat-icon>label</mat-icon>
                    {{doc.category}}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Messages Section -->
      <div class="page-content" *ngIf="activeSection === 'messages'">
        <div class="page-header">
          <button class="back-btn" (click)="setActiveSection('dashboard')">
            <mat-icon>arrow_back</mat-icon>
            Back to Dashboard
          </button>
          <div class="page-title">
            <h2>Messages</h2>
            <p>Communicate with your landlord and property manager</p>
          </div>
        </div>
        
        <div class="content-grid">
          <div class="card collapsible-card" 
               [class.collapsed]="isSectionCollapsed('messages')"
               [class.animating]="isAnimating('messages')">
            <div class="card-header clickable-header" (click)="toggleSection('messages')">
              <div class="card-title">
                <mat-icon class="card-icon">chat</mat-icon>
                <h3>Conversations</h3>
              </div>
              <button class="collapse-toggle">
                <mat-icon class="collapse-icon">expand_more</mat-icon>
              </button>
            </div>
            <div class="card-content collapsible-content" [class.collapsed]="isSectionCollapsed('messages')">
              <div class="conversation-list">
                <div class="conversation-item" 
                     *ngFor="let conversation of conversations"
                     [class.active]="activeConversationId === conversation.id"
                     (click)="setActiveConversation(conversation.id)">
                  <div class="conversation-avatar">{{conversation.avatarText}}</div>
                  <div class="conversation-info">
                    <div class="conversation-name">{{conversation.name}}</div>
                    <div class="conversation-preview">{{conversation.lastMessage}}</div>
                  </div>
                  <div class="conversation-time">
                    <mat-icon class="time-icon">schedule</mat-icon>
                    {{conversation.time}}
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <mat-icon class="card-icon">send</mat-icon>
                <h3>Send New Message</h3>
              </div>
            </div>
            <div class="card-content">
              <form (ngSubmit)="sendMessage()" #messageForm="ngForm" class="modern-form">
                <div class="form-group">
                  <label for="recipient" class="form-label">
                    <mat-icon>person</mat-icon>
                    To
                  </label>
                  <select id="recipient" [(ngModel)]="newMessage.recipient" name="recipient" class="form-select" required>
                    <option value="">Select recipient</option>
                    <option value="landlord">{{landlordName}} (Landlord)</option>
                    <option value="caretaker">{{caretakerName}} (Caretaker)</option>
                    <option value="management">Property Management</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label for="subject" class="form-label">
                    <mat-icon>subject</mat-icon>
                    Subject
                  </label>
                  <input 
                    type="text" 
                    id="subject" 
                    [(ngModel)]="newMessage.subject" 
                    name="subject"
                    class="form-input" 
                    placeholder="Message subject">
                </div>
                
                <div class="form-group">
                  <label for="content" class="form-label">
                    <mat-icon>message</mat-icon>
                    Message
                  </label>
                  <textarea 
                    id="content" 
                    [(ngModel)]="newMessage.content" 
                    name="content"
                    class="form-textarea" 
                    rows="6"
                    placeholder="Type your message here..."
                    required></textarea>
                </div>
                
                <button type="submit" class="btn btn-primary" [disabled]="!messageForm.form.valid">
                  <mat-icon>send</mat-icon>
                  Send Message
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Marketplace Section -->
      <div class="page-content" *ngIf="activeSection === 'marketplace'">
        <div class="page-header">
          <button class="back-btn" (click)="setActiveSection('dashboard')">
            <mat-icon>arrow_back</mat-icon>
            Back to Dashboard
          </button>
          <div class="page-title">
            <h2>Community Marketplace</h2>
            <p>Buy, sell, and trade with your neighbors</p>
          </div>
        </div>
        
        <div class="card collapsible-card" 
             [class.collapsed]="isSectionCollapsed('marketplace')"
             [class.animating]="isAnimating('marketplace')">
          <div class="card-header clickable-header" (click)="toggleSection('marketplace')">
            <div class="marketplace-tabs" (click)="$event.stopPropagation()">
              <button 
                class="tab" 
                [class.active]="activeMarketplaceTab === 'items'"
                (click)="setActiveMarketplaceTab('items')">
                <mat-icon>shopping_cart</mat-icon>
                Items for Sale
              </button>
              <button 
                class="tab" 
                [class.active]="activeMarketplaceTab === 'services'"
                (click)="setActiveMarketplaceTab('services')">
                <mat-icon>handyman</mat-icon>
                Services
              </button>
              <button 
                class="tab" 
                [class.active]="activeMarketplaceTab === 'housing'"
                (click)="setActiveMarketplaceTab('housing')">
                <mat-icon>home</mat-icon>
                Housing
              </button>
            </div>
            <button class="collapse-toggle">
              <mat-icon class="collapse-icon">expand_more</mat-icon>
            </button>
          </div>
          <div class="card-content collapsible-content" [class.collapsed]="isSectionCollapsed('marketplace')">
            <div class="marketplace-grid">
              <div class="marketplace-card" *ngFor="let item of getMarketplaceItems()">
                <div class="marketplace-image">
                  <div class="placeholder-image">
                    <mat-icon>image</mat-icon>
                  </div>
                </div>
                <div class="marketplace-info">
                  <h4>{{item.title}}</h4>
                  <p class="marketplace-description">{{item.description}}</p>
                  <div class="marketplace-meta">
                    <div class="marketplace-price">
                      <mat-icon>attach_money</mat-icon>
                      KSH {{formatNumber(item.price)}}
                    </div>
                    <div class="marketplace-location">
                      <mat-icon>location_on</mat-icon>
                      {{item.location}}
                    </div>
                  </div>
                  <div class="marketplace-seller">
                    <mat-icon>person</mat-icon>
                    Seller: {{item.seller}}
                  </div>
                </div>
                <div class="marketplace-actions">
                  <button class="btn btn-primary">
                    <mat-icon>phone</mat-icon>
                    Contact Seller
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Reviews Section -->
      <div class="page-content" *ngIf="activeSection === 'reviews'">
        <div class="page-header">
          <button class="back-btn" (click)="setActiveSection('dashboard')">
            <mat-icon>arrow_back</mat-icon>
            Back to Dashboard
          </button>
          <div class="page-title">
            <h2>Reviews & Ratings</h2>
            <p>Rate your experience and see community feedback</p>
          </div>
        </div>
        
        <div class="content-grid">
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <mat-icon class="card-icon">star</mat-icon>
                <h3>Overall Rating</h3>
              </div>
            </div>
            <div class="card-content">
              <div class="rating-summary">
                <div class="rating-score">{{averageRating}}</div>
                <div class="rating-stars">
                  <mat-icon *ngFor="let i of [1,2,3,4,5]" [class.filled]="i <= averageRating">star</mat-icon>
                </div>
                <div class="rating-count">
                  <mat-icon>reviews</mat-icon>
                  {{recentReviews.length}} reviews
                </div>
              </div>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <mat-icon class="card-icon">rate_review</mat-icon>
                <h3>Leave a Review</h3>
              </div>
            </div>
            <div class="card-content">
              <form class="modern-form">
                <div class="form-group">
                  <label class="form-label">
                    <mat-icon>star</mat-icon>
                    Rating
                  </label>
                  <div class="rating-input">
                    <mat-icon *ngFor="let i of [1,2,3,4,5]" class="rating-star">star</mat-icon>
                  </div>
                </div>
                <div class="form-group">
                  <label for="review" class="form-label">
                    <mat-icon>comment</mat-icon>
                    Your Review
                  </label>
                  <textarea 
                    id="review" 
                    class="form-textarea" 
                    rows="4"
                    placeholder="Share your experience..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary">
                  <mat-icon>send</mat-icon>
                  Submit Review
                </button>
              </form>
            </div>
          </div>
        </div>
        
        <div class="card collapsible-card" 
             [class.collapsed]="isSectionCollapsed('reviews')"
             [class.animating]="isAnimating('reviews')">
          <div class="card-header clickable-header" (click)="toggleSection('reviews')">
            <div class="card-title">
              <mat-icon class="card-icon">reviews</mat-icon>
              <h3>Recent Reviews</h3>
            </div>
            <button class="collapse-toggle">
              <mat-icon class="collapse-icon">expand_more</mat-icon>
            </button>
          </div>
          <div class="card-content collapsible-content" [class.collapsed]="isSectionCollapsed('reviews')">
            <div class="review-list">
              <div class="review-card" *ngFor="let review of recentReviews">
                <div class="review-header">
                  <div class="review-avatar">{{review.reviewer.charAt(0)}}</div>
                  <div class="review-meta">
                    <div class="reviewer-name">{{review.reviewer}}</div>
                    <div class="review-date">
                      <mat-icon>schedule</mat-icon>
                      {{review.date}}
                    </div>
                  </div>
                  <div class="review-rating">
                    <mat-icon *ngFor="let i of [1,2,3,4,5]" [class.filled]="i <= review.rating">star</mat-icon>
                  </div>
                </div>
                <div class="review-content">{{review.content}}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Settings Section -->
      <div class="page-content" *ngIf="activeSection === 'settings'">
        <div class="page-header">
          <button class="back-btn" (click)="setActiveSection('dashboard')">
            <mat-icon>arrow_back</mat-icon>
            Back to Dashboard
          </button>
          <div class="page-title">
            <h2>Account Settings</h2>
            <p>Manage your account preferences and information</p>
          </div>
        </div>
        
        <div class="settings-grid">
          <div class="card collapsible-card" 
               [class.collapsed]="isSectionCollapsed('settings')"
               [class.animating]="isAnimating('settings')">
            <div class="card-header clickable-header" (click)="toggleSection('settings')">
              <div class="card-title">
                <mat-icon class="card-icon">person</mat-icon>
                <h3>Personal Information</h3>
              </div>
              <button class="collapse-toggle">
                <mat-icon class="collapse-icon">expand_more</mat-icon>
              </button>
            </div>
            <div class="card-content collapsible-content" [class.collapsed]="isSectionCollapsed('settings')">
              <form class="modern-form">
                <div class="form-group">
                  <label for="fullName" class="form-label">
                    <mat-icon>badge</mat-icon>
                    Full Name
                  </label>
                  <input type="text" id="fullName" class="form-input" [value]="userName">
                </div>
                <div class="form-group">
                  <label for="email" class="form-label">
                    <mat-icon>email</mat-icon>
                    Email Address
                  </label>
                  <input type="email" id="email" class="form-input" value="john.doe@email.com">
                </div>
                <div class="form-group">
                  <label for="phone" class="form-label">
                    <mat-icon>phone</mat-icon>
                    Phone Number
                  </label>
                  <input type="tel" id="phone" class="form-input" value="+254 700 123 456">
                </div>
                <button type="submit" class="btn btn-primary">
                  <mat-icon>save</mat-icon>
                  Update Information
                </button>
              </form>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <mat-icon class="card-icon">notifications</mat-icon>
                <h3>Notification Preferences</h3>
              </div>
            </div>
            <div class="card-content">
              <div class="preferences-list">
                <label class="preference-item">
                  <input type="checkbox" checked class="checkbox">
                  <span class="checkbox-label">
                    <mat-icon>email</mat-icon>
                    Email notifications for rent reminders
                  </span>
                </label>
                <label class="preference-item">
                  <input type="checkbox" checked class="checkbox">
                  <span class="checkbox-label">
                    <mat-icon>sms</mat-icon>
                    SMS notifications for maintenance updates
                  </span>
                </label>
                <label class="preference-item">
                  <input type="checkbox" class="checkbox">
                  <span class="checkbox-label">
                    <mat-icon>notifications</mat-icon>
                    Push notifications for messages
                  </span>
                </label>
              </div>
              <button class="btn btn-primary">
                <mat-icon>save</mat-icon>
                Save Preferences
              </button>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <mat-icon class="card-icon">security</mat-icon>
                <h3>Security</h3>
              </div>
            </div>
            <div class="card-content">
              <form class="modern-form">
                <div class="form-group">
                  <label for="currentPassword" class="form-label">
                    <mat-icon>lock</mat-icon>
                    Current Password
                  </label>
                  <input type="password" id="currentPassword" class="form-input">
                </div>
                <div class="form-group">
                  <label for="newPassword" class="form-label">
                    <mat-icon>lock_open</mat-icon>
                    New Password
                  </label>
                  <input type="password" id="newPassword" class="form-input">
                </div>
                <div class="form-group">
                  <label for="confirmPassword" class="form-label">
                    <mat-icon>lock_outline</mat-icon>
                    Confirm New Password
                  </label>
                  <input type="password" id="confirmPassword" class="form-input">
                </div>
                <button type="submit" class="btn btn-primary">
                  <mat-icon>vpn_key</mat-icon>
                  Change Password
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </main>
</div>