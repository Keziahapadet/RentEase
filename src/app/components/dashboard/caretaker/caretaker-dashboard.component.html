
<div class="mobile-overlay" 
     [class.active]="isMobile && isMobileMenuOpen"
     (click)="closeMobileMenu()"></div>

<div class="caretaker-dashboard">
 
  <div class="sidebar" 
       [class.sidebar-collapsed]="!isSidebarOpen && !isMobile"
       [class.mobile-open]="isMobileMenuOpen">
    <div class="sidebar-header">
      <div class="logo">
        <mat-icon>handyman</mat-icon>
        <span class="logo-text" *ngIf="isSidebarOpen || isMobile">Caretaker Panel</span>
      </div>
      <button class="sidebar-toggle" (click)="toggleSidebar()" *ngIf="!isMobile">
        <mat-icon>{{isSidebarOpen ? 'chevron_left' : 'chevron_right'}}</mat-icon>
      </button>
    </div>

    <nav class="sidebar-nav">
      <a *ngFor="let item of navItems" 
         class="nav-item" 
         [class.active]="currentView === item.id"
         (click)="setView(item.id)">
        <mat-icon class="nav-icon">{{item.icon}}</mat-icon>
        <span class="nav-label" *ngIf="isSidebarOpen || isMobile">{{item.label}}</span>
      </a>
    </nav>

    <div class="sidebar-footer">
      <button class="logout-btn" (click)="logout()">
        <mat-icon>logout</mat-icon>
        <span *ngIf="isSidebarOpen || isMobile">Logout</span>
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content" 
       [class.content-expanded]="!isSidebarOpen && !isMobile"
       [class.sidebar-open]="isMobileMenuOpen">
    <div class="top-header">
      <div class="header-left">
        <button class="menu-toggle" (click)="toggleSidebar()">
          <mat-icon>menu</mat-icon>
        </button>
        <h1 class="page-title">Caretaker Dashboard</h1>
      </div>
      
      <div class="header-actions">
        <button class="btn btn-secondary" (click)="refreshData()">
          <mat-icon>refresh</mat-icon>
          <span class="btn-text">Refresh</span>
        </button>
        
      
        <div class="user-menu">
          <app-profile-picture
            [editable]="true"
            [showName]="false"
            size="small"
            (pictureUpdated)="onPictureUpdated($event)"
            (pictureDeleted)="onPictureDeleted()">
          </app-profile-picture>
          <span class="user-name">{{userProfile?.fullName || 'Caretaker'}}</span>
        </div>
      </div>
    </div>

    <div class="dashboard-content">
      
      <!-- Overview View -->
      <div *ngIf="currentView === 'overview'" class="overview-view">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon maintenance">
              <mat-icon>build</mat-icon>
            </div>
            <div class="stat-info">
              <div class="stat-value">{{formatNumber(stats.pendingMaintenance)}}</div>
              <div class="stat-label">Pending Maintenance</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon inspections">
              <mat-icon>home</mat-icon>
            </div>
            <div class="stat-info">
              <div class="stat-value">{{formatNumber(stats.scheduledInspections)}}</div>
              <div class="stat-label">Scheduled Inspections</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon deposits">
              <mat-icon>account_balance</mat-icon>
            </div>
            <div class="stat-info">
              <div class="stat-value">{{formatNumber(stats.activeDepositCases)}}</div>
              <div class="stat-label">Active Deposit Cases</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon completed">
              <mat-icon>check_circle</mat-icon>
            </div>
            <div class="stat-info">
              <div class="stat-value">{{formatNumber(stats.completedJobs)}}</div>
              <div class="stat-label">Completed Jobs</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon response">
              <mat-icon>timer</mat-icon>
            </div>
            <div class="stat-info">
              <div class="stat-value">{{stats.responseRate}}%</div>
              <div class="stat-label">Response Rate</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon satisfaction">
              <mat-icon>star</mat-icon>
            </div>
            <div class="stat-info">
              <div class="stat-value">{{stats.tenantSatisfaction}}/5</div>
              <div class="stat-label">Tenant Satisfaction</div>
            </div>
          </div>
        </div>

        <div class="quick-actions-section">
          <h3>Quick Actions</h3>
          <div class="actions-grid">
            <button *ngFor="let action of quickActions" class="action-btn" (click)="action.action()">
              <div class="action-icon" [style.background-color]="action.color">
                <mat-icon>{{action.icon}}</mat-icon>
              </div>
              <span class="action-label">{{action.title}}</span>
              <span class="action-description">{{action.description}}</span>
            </button>
          </div>
        </div>

        <!-- Coming Soon Message -->
        <div class="coming-soon-section">
          <div class="coming-soon-card">
            <mat-icon>construction</mat-icon>
            <h3>Features Coming Soon</h3>
            <p>Maintenance, Inspections, and Deposit management features will be available soon.</p>
            <p class="subtext">Currently showing demo data for preview purposes.</p>
          </div>
        </div>
      </div>

      <!-- Coming Soon Views -->
      <div *ngIf="currentView === 'maintenance'" class="coming-soon-view">
        <div class="coming-soon-card large">
          <mat-icon>build</mat-icon>
          <h2>Maintenance Management</h2>
          <p>This feature is coming soon! You'll be able to manage maintenance requests, track progress, and communicate with tenants.</p>
          <button class="btn btn-primary" disabled>Coming Soon</button>
        </div>
      </div>

      <div *ngIf="currentView === 'inspections'" class="coming-soon-view">
        <div class="coming-soon-card large">
          <mat-icon>home</mat-icon>
          <h2>Property Inspections</h2>
          <p>This feature is coming soon! Schedule and conduct property inspections, document findings, and manage inspection reports.</p>
          <button class="btn btn-primary" disabled>Coming Soon</button>
        </div>
      </div>

      <div *ngIf="currentView === 'deposits'" class="coming-soon-view">
        <div class="coming-soon-card large">
          <mat-icon>account_balance</mat-icon>
          <h2>Deposit Management</h2>
          <p>This feature is coming soon! Process security deposits, handle deductions, and manage deposit refunds efficiently.</p>
          <button class="btn btn-primary" disabled>Coming Soon</button>
        </div>
      </div>

      <div *ngIf="currentView === 'properties'" class="coming-soon-view">
        <div class="coming-soon-card large">
          <mat-icon>apartment</mat-icon>
          <h2>Properties Management</h2>
          <p>This feature is coming soon! View and manage properties under your care, track maintenance schedules, and coordinate with landlords.</p>
          <button class="btn btn-primary" disabled>Coming Soon</button>
        </div>
      </div>

      <div *ngIf="currentView === 'messages'" class="coming-soon-view">
        <div class="coming-soon-card large">
          <mat-icon>chat</mat-icon>
          <h2>Messages</h2>
          <p>This feature is coming soon! Communicate with tenants, landlords, and maintenance teams through our integrated messaging system.</p>
          <button class="btn btn-primary" disabled>Coming Soon</button>
        </div>
      </div>

      <div *ngIf="currentView === 'reports'" class="coming-soon-view">
        <div class="coming-soon-card large">
          <mat-icon>assessment</mat-icon>
          <h2>Reports & Analytics</h2>
          <p>This feature is coming soon! Generate detailed reports on maintenance activities, inspection results, and property performance.</p>
          <button class="btn btn-primary" disabled>Coming Soon</button>
        </div>
      </div>

      <!-- Profile View -->
      <div *ngIf="currentView === 'profile'" class="profile-view">
        <div class="view-header">
          <h2>My Profile</h2>
          <div class="view-actions">
            <button class="btn btn-primary" (click)="setView('overview')">
              <mat-icon>arrow_back</mat-icon>
              Back to Dashboard
            </button>
          </div>
        </div>
        
        <app-profile-view 
          *ngIf="currentView === 'profile'"
          (editProfile)="navigateToProfileEdit()"
          (goBack)="setView('overview')">
        </app-profile-view>
      </div>

      <!-- Profile Edit View -->
      <div *ngIf="currentView === 'profile-edit'" class="profile-edit-view">
        <div class="view-header">
          <h2>Edit Profile</h2>
          <div class="view-actions">
            <button class="btn btn-secondary" (click)="navigateToProfileView()">
              <mat-icon>arrow_back</mat-icon>
              Back to Profile
            </button>
          </div>
        </div>
        
        <app-profile-edit 
          *ngIf="currentView === 'profile-edit'"
          (goBack)="navigateToProfileView()">
        </app-profile-edit>
      </div>

    </div>
  </div>
</div>