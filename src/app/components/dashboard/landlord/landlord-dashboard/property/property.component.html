<div class="units-container">
  <div class="property-header" *ngIf="property">
    <div class="header-content">
      <div class="breadcrumb">
        <button class="breadcrumb-link" (click)="goBackToProperties()">
          <mat-icon>home</mat-icon> Properties
        </button>
        <mat-icon class="breadcrumb-separator">chevron_right</mat-icon>
        <button class="breadcrumb-link" (click)="goBackToProperty()">
          {{ property?.name ?? '-' }}
        </button>
        <mat-icon class="breadcrumb-separator">chevron_right</mat-icon>
        <span class="breadcrumb-current">Units</span>
      </div>
      
      <h1>{{ property?.name ?? '-' }} - Units</h1>
      <p>
        <mat-icon>location_on</mat-icon>
        {{ property?.location ?? '-' }}
      </p>
    </div>
    

    <div class="stats-row">
      <div class="stat-item" (click)="navigateToTotalUnits()" matTooltip="Click to show all units">
        <div class="stat-value">{{ totalUnits }}</div>
        <div class="stat-label">Total Units</div>
      </div>
      <div class="stat-item" (click)="navigateToOccupiedUnits()" matTooltip="Click to show occupied units">
        <div class="stat-value">{{ occupiedUnits }}</div>
        <div class="stat-label">Occupied</div>
      </div>
      <div class="stat-item" (click)="navigateToOccupancyAnalytics()" matTooltip="Click to view occupancy analytics">
        <div class="stat-value">{{ occupancyRate }}%</div>
        <div class="stat-label">Occupancy</div>
      </div>
      <div class="stat-item" (click)="navigateToRevenueAnalytics()" matTooltip="Click to view revenue analytics">
        <div class="stat-value">{{ formatCompactCurrency(monthlyRevenue) }}</div>
        <div class="stat-label">Monthly Revenue</div>
      </div>
    </div>
  </div>

  <div class="controls-section">
    <div class="section-title">
      <h2>Enhanced Table View</h2>
      <div class="title-underline"></div>
    </div>

    <div class="controls">
      <div class="search-box">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search units...</mat-label>
          <input matInput [(ngModel)]="searchTerm" (input)="onSearchChange()" placeholder="Unit number, type, tenant...">
          <mat-icon matPrefix>search</mat-icon>
        </mat-form-field>
      </div>
      
      <div class="filter-buttons">
        <button class="filter-btn" [class.active]="activeFilter === 'all'" (click)="setFilter('all')">All</button>
        <button class="filter-btn" [class.active]="activeFilter === 'occupied'" (click)="setFilter('occupied')">Occupied</button>
        <button class="filter-btn" [class.active]="activeFilter === 'vacant'" (click)="setFilter('vacant')">Vacant</button>
        <button class="filter-btn" [class.active]="activeFilter === 'maintenance'" (click)="setFilter('maintenance')">Maintenance</button>
      </div>
      
      <div class="header-actions">
        <button class="btn-primary" (click)="createNewUnit()">
          <mat-icon>add</mat-icon> New Unit
        </button>
        <button class="btn-secondary" (click)="refreshUnits()">
          <mat-icon>refresh</mat-icon> Refresh
        </button>
      </div>
    </div>
  </div>


  <div *ngIf="loading" class="loading-container">
    <div class="loading-content">
      <mat-icon class="loading-spinner spinning">hourglass_top</mat-icon>
      <p>Loading units...</p>
    </div>
  </div>

  <div *ngIf="!loading && errorMessage" class="error-container">
    <div class="error-content">
      <mat-icon class="error-icon">error_outline</mat-icon>
      <h3>Error Loading Units</h3>
      <p>{{ errorMessage }}</p>
      <button class="btn-primary" (click)="refreshUnits()">
        <mat-icon>refresh</mat-icon> Try Again
      </button>
    </div>
  </div>


  <div *ngIf="!loading && !errorMessage && units.length === 0" class="empty-state">
    <div class="empty-content">
      <mat-icon>meeting_room</mat-icon>
      <h3>No Units Found</h3>
      <p>This property doesn't have any units yet. Start by adding your first unit.</p>
      <button class="btn-primary" (click)="createNewUnit()">
        <mat-icon>add</mat-icon> Add First Unit
      </button>
    </div>
  </div>

  <div *ngIf="!loading && !errorMessage && filteredUnits.length > 0" class="table-container">
    <table class="units-table">
      <thead>
        <tr>
          <th>UNIT</th>
          <th>TYPE</th>
          <th>TENANT</th>
          <th>STATUS</th>
          <th>RENT</th>
          <th>DEPOSIT</th>
          <th>DESCRIPTION</th>
          <th>ACTIONS</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let unit of filteredUnits" class="unit-row" (click)="viewUnit(unit.id)">
          
      
          <td class="unit-cell">
            <div class="unit-info">
              <div class="unit-avatar">{{ unit.unitNumber ?? '-' }}</div>
              <div class="unit-details">
                <h4>Unit {{ unit.unitNumber ?? '-' }}</h4>
                <p>{{ getUnitTypeDisplay(unit) }}</p>
              </div>
            </div>
          </td>
          
         
          
          <td class="type-cell">
            <span class="type-text">{{ getUnitTypeDisplay(unit) }}</span>
          </td>
          
          <td class="tenant-cell">
            <div class="tenant-info">
              <span class="tenant-name">{{ unit.tenant?.name ?? unit.tenant?.email ?? '-' }}</span>
              <span class="tenant-email" *ngIf="unit.tenant?.email">{{ unit.tenant?.email }}</span>
            </div>
          </td>
          
          <td class="status-cell">
            <span class="status-badge" [class]="getStatusClass(unit.status)">{{ (unit.status ?? 'vacant') | uppercase }}</span>
          </td>
          
      
          <td class="rent-cell">
            <div class="amount-info">
              <span class="currency">KES</span>
              <span class="amount">{{ (unit.rentAmount ?? 0) | number:'1.0-0' }}</span>
            </div>
          </td>
          
          <td class="deposit-cell">
            <div class="amount-info">
              <span class="currency">KES</span>
              <span class="amount">{{ (unit.deposit ?? 0) | number:'1.0-0' }}</span>
            </div>
          </td>
          
          <td class="description-cell">
            <span class="description-text" [title]="unit.description ?? 'No description'" matTooltip="{{ unit.description ?? 'No description' }}">
              {{ getUnitDescription(unit) }}
            </span>
          </td>
          
          <td class="actions-cell" (click)="$event.stopPropagation()">
            <div class="action-buttons">
              <button class="btn btn-view" (click)="viewUnit(unit.id)" matTooltip="View Unit Details">VIEW</button>
              <button class="btn btn-edit" (click)="editUnit(unit.id, $event)" matTooltip="Edit Unit"><mat-icon>edit</mat-icon></button>
              <button class="btn btn-delete" (click)="onDeleteUnit(unit.id, $event)" matTooltip="Delete Unit"><mat-icon>delete</mat-icon></button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="!loading && !errorMessage && units.length > 0 && filteredUnits.length === 0" class="filtered-empty-state">
    <div class="empty-content">
      <mat-icon>search_off</mat-icon>
      <h3>No Units Match Your Search</h3>
      <p>Try adjusting your search terms or filters.</p>
      <button class="btn-secondary" (click)="searchTerm = ''; setFilter('all')">
        <mat-icon>clear</mat-icon> Clear Filters
      </button>
    </div>
  </div>

  <div *ngIf="!loading && filteredUnits.length > 0" class="results-summary">
    <div class="summary-content">
      <div class="results-info">
        <span class="results-text">
          Showing <strong>{{ filteredUnits.length }}</strong> of <strong>{{ totalUnits }}</strong> units
          <span *ngIf="activeFilter !== 'all'" class="filter-indicator">(filtered by: <strong>{{ activeFilter }}</strong>)</span>
        </span>
      </div>
      <div class="quick-stats">
        <span class="stat">Occupied: <strong>{{ occupiedUnits }}</strong></span>
        <span class="stat">Vacant: <strong>{{ totalUnits - occupiedUnits }}</strong></span>
        <span class="stat">Revenue: <strong>{{ formatCompactCurrency(monthlyRevenue) }}</strong></span>
      </div>
    </div>
  </div>
</div>
