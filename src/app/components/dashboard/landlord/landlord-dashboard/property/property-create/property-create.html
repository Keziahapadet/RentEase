<div class="property-create-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <button class="back-button" (click)="onCancel()" type="button" [disabled]="isSubmitting">
        <mat-icon>arrow_back</mat-icon>
        <span>Back to Properties</span>
      </button>
      <div class="header-text">
        <h1>Create New Property</h1>
        <p>Add a new property to your portfolio</p>
      </div>
    </div>
  </div>

  <!-- Debug Info (Remove in production) -->
  <div class="debug-info" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 16px; margin-bottom: 24px; font-size: 13px;">
    <h4 style="color: #495057; margin: 0 0 12px 0; font-size: 16px;">üêõ Debug Information</h4>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
      <div><strong>User:</strong> {{ authService.getCurrentUser()?.email || 'Not logged in' }}</div>
      <div><strong>Role:</strong> {{ authService.getCurrentUser()?.role || 'No role' }}</div>
      <div><strong>User ID:</strong> {{ authService.getCurrentUser()?.id || 'No ID' }}</div>
      <div><strong>Verified:</strong> {{ authService.getCurrentUser()?.verified ? 'Yes' : 'No' }}</div>
      <div><strong>Has Token:</strong> {{ !!authService.getToken() ? 'Yes' : 'No' }}</div>
      <div><strong>Is Authenticated:</strong> {{ authService.isAuthenticated() ? 'Yes' : 'No' }}</div>
      <div><strong>Can Manage:</strong> {{ propertyService.canManageProperties() ? 'Yes' : 'No' }}</div>
      <div><strong>Token Length:</strong> {{ authService.getToken()?.length || 0 }}</div>
    </div>
    <button type="button" (click)="refreshPermissions()" style="background: #007bff; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-top: 8px; font-size: 12px;">Refresh Permissions</button>
  </div>

  <!-- Success Message -->
  <div *ngIf="successMessage" class="alert alert-success">
    <mat-icon>check_circle</mat-icon>
    {{ successMessage }}
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-error">
    <mat-icon>error</mat-icon>
    {{ errorMessage }}
  </div>

  <!-- Form -->
  <form [formGroup]="propertyForm" (ngSubmit)="onSubmit()" class="property-form">
    
    <!-- Property Name -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Property Name</mat-label>
      <input matInput 
             formControlName="name" 
             placeholder="Enter property name"
             maxlength="100">
      <mat-icon matSuffix>business</mat-icon>
      <mat-error *ngIf="hasFieldError('name')">
        {{ getErrorMessage('name') }}
      </mat-error>
    </mat-form-field>

    <!-- Location -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Location</mat-label>
      <input matInput 
             formControlName="location" 
             placeholder="Enter property location"
             maxlength="200">
      <mat-icon matSuffix>location_on</mat-icon>
      <mat-error *ngIf="hasFieldError('location')">
        {{ getErrorMessage('location') }}
      </mat-error>
    </mat-form-field>

    <!-- Property Type -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Property Type</mat-label>
      <mat-select formControlName="propertyType">
        <mat-option *ngFor="let type of propertyTypes" [value]="type.value">
          {{ type.label }}
        </mat-option>
      </mat-select>
      <mat-icon matSuffix>home</mat-icon>
      <mat-error *ngIf="hasFieldError('propertyType')">
        {{ getErrorMessage('propertyType') }}
      </mat-error>
    </mat-form-field>

    <!-- Total Units -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Total Units</mat-label>
      <input matInput 
             type="number" 
             formControlName="totalUnits" 
             placeholder="Enter total units"
             min="1" 
             max="10000">
      <mat-icon matSuffix>apartment</mat-icon>
      <mat-error *ngIf="hasFieldError('totalUnits')">
        {{ getErrorMessage('totalUnits') }}
      </mat-error>
    </mat-form-field>

    <!-- Description -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Description (Optional)</mat-label>
      <textarea matInput 
                formControlName="description" 
                placeholder="Enter property description"
                rows="4" 
                maxlength="1000"></textarea>
      <mat-icon matSuffix>description</mat-icon>
      <mat-hint align="end" 
               [class.text-warning]="isDescriptionNearLimit()">
        {{ getRemainingCharacters() }} characters remaining
      </mat-hint>
      <mat-error *ngIf="hasFieldError('description')">
        {{ getErrorMessage('description') }}
      </mat-error>
    </mat-form-field>

    <!-- Form Actions -->
    <div class="form-actions">
      <button type="button" 
              mat-stroked-button 
              (click)="onCancel()"
              [disabled]="isSubmitting">
        <mat-icon>cancel</mat-icon>
        Cancel
      </button>
      
      <button type="submit" 
              mat-raised-button 
              color="primary"
              [disabled]="!isFormValid">
        <mat-icon *ngIf="!isSubmitting">save</mat-icon>
        <mat-icon *ngIf="isSubmitting" class="spinning">hourglass_empty</mat-icon>
        {{ isSubmitting ? 'Creating...' : 'Create Property' }}
      </button>
    </div>
  </form>
</div>